import{_ as i}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as l,o,c as r,b as e,d as n,a,e as t}from"./app-zSMpBOKH.js";const d={},c=t(`<h1 id="ipv6-防火墙配置" tabindex="-1"><a class="header-anchor" href="#ipv6-防火墙配置" aria-hidden="true">#</a> IPv6 防火墙配置</h1><h2 id="获取不变后缀" tabindex="-1"><a class="header-anchor" href="#获取不变后缀" aria-hidden="true">#</a> 获取不变后缀</h2><h3 id="eui-64" tabindex="-1"><a class="header-anchor" href="#eui-64" aria-hidden="true">#</a> EUI-64</h3><p><strong>Linux</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">ifconfig</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>配置Netplan</strong></p><p>修改 /etc/netplan 内的yaml文件</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>network:
  version: 2
  ethernets:
    enp0s3:
      ipv6-privacy: off
      ipv6-address-generation: eui64
  renderer: NetworkManage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>sudo vim /etc/NetworkManager/system-connections/NET_NAME</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">ipv6</span><span class="token punctuation">]</span>
<span class="token comment">#addr-gen-mode=stable-privacy</span>
<span class="token key property">addr-gen-mode</span><span class="token punctuation">=</span>eui64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>systemctl restart NetworkManager</code> 重启服务</p><p><strong>取消临时ipv6地址</strong></p><p>修改文件 /etc/sysctl.d/10-ipv6-privacy.conf 执行 <code>sysctl -p</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># set zero,将这两个值设置为0</span>
net.ipv6.conf.all.use_tempaddr <span class="token operator">=</span> <span class="token number">0</span>
net.ipv6.conf.default.use_tempaddr <span class="token operator">=</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14),p={href:"https://gist.github.com/wanyvic/50405c94c06fe77f45331d9a11e41044#file-ubuntu20-ipv6-eui-64-md",target:"_blank",rel:"noopener noreferrer"},u=e("br",null,null,-1),v={href:"https://www.cnblogs.com/osnosn/p/11396868.html",target:"_blank",rel:"noopener noreferrer"},m=e("br",null,null,-1),b={href:"https://askubuntu.com/questions/1237785/how-to-configure-ipv6-with-eui-64-interface-id-on-ubuntu-18-04",target:"_blank",rel:"noopener noreferrer"},h=e("br",null,null,-1),f={href:"https://netplan.readthedocs.io/en/latest/netplan-yaml/",target:"_blank",rel:"noopener noreferrer"},g=t(`<p><strong>Windows</strong></p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code><span class="token function">set</span><span class="token operator">-</span>netipv6protocol <span class="token operator">-</span>RandomizeIdentifiers Disabled  <span class="token comment"># Windows 默认不使用 EUI-64，启用它</span>
ipconfig <span class="token operator">/</span>all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,2),k=e("li",null,[n("找到一个 IP 地址，它应该类似于 "),e("code",null,"2001:2002:2003:2004:****:**ff:fe**:****"),n("，它就是该设备的 EUI-64 地址。")],-1),_=e("li",null,[n("记下 "),e("code",null,"****:**ff:fe**:****"),n(" 的部分，"),e("strong",null,"下文假设它是"),n(),e("code",null,"1:20ff:fe77:2077"),n("。")],-1),x={href:"https://ccie.lol/knowledge-base/ipv6-use-eui-64-convert-link-local-address/",target:"_blank",rel:"noopener noreferrer"},N=t(`<h2 id="配置防火墙" tabindex="-1"><a class="header-anchor" href="#配置防火墙" aria-hidden="true">#</a> 配置防火墙</h2><p>向 OpenWrt 添加一条通信规则（访问 <code>cgi-bin/luci/admin/network/firewall/rules</code>）：</p><ul><li>协议：<code>TCP 和 UDP</code></li><li>源区域：<code>wan</code> (包含 wan, wan6)</li><li>目标区域：<code>lan</code></li><li>目标地址： <ul><li>使用 EUI-64 或 DHCPv6：<code>::&lt;需要暴露的主机的后缀&gt;/::ffff:ffff:ffff:ffff</code>，如 <code>::1:20ff:fe77:2077/::ffff:ffff:ffff:ffff</code> 或 <code>::a1cd/::ffff:ffff:ffff:ffff</code>（如果子网大小不是 <code>/64</code>，请自行改变掩码）</li><li>使用临时地址：留空（注意：这会导致其他主机一并暴露，请避免同时留空目标端口）</li></ul></li><li>目标端口： <ul><li>暴露特定端口：<code>&lt;需要暴露的端口或端口范围&gt;</code></li><li>整台主机暴露：留空</li></ul></li><li>操作：<code>接受</code></li><li>高级设置 <ul><li>限制地址类型：<code>仅 IPv6</code></li></ul></li><li>其余维持默认 <ul><li>特别提醒：源端口留空，只填目标端口</li></ul></li></ul><h2 id="配置-ddns" tabindex="-1"><a class="header-anchor" href="#配置-ddns" aria-hidden="true">#</a> 配置 DDNS</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">CURRENT_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> ipv6.ip.sb<span class="token variable">)</span></span>
<span class="token assign-left variable">DNS_RECORD</span><span class="token operator">=</span><span class="token operator">&lt;</span>域名<span class="token operator">&gt;</span>
<span class="token assign-left variable">ZONE_ID</span><span class="token operator">=</span><span class="token operator">&lt;</span>Zone ID<span class="token operator">&gt;</span>
<span class="token assign-left variable">DNS_ID</span><span class="token operator">=</span><span class="token operator">&lt;</span>DNS 记录 ID<span class="token operator">&gt;</span>
<span class="token assign-left variable">TOKEN</span><span class="token operator">=</span><span class="token operator">&lt;</span>API token<span class="token operator">&gt;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /run/current_ip <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token variable">)</span></span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;<span class="token variable">$CURRENT_IP</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$CURRENT_IP</span> <span class="token operator">&gt;</span> /run/current_ip
        <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token punctuation">\\</span>
             <span class="token parameter variable">-X</span> PUT <span class="token string">&quot;https://api.cloudflare.com/client/v4/zones/<span class="token variable">$ZONE_ID</span>/dns_records/<span class="token variable">$DNS_ID</span>&quot;</span> <span class="token punctuation">\\</span>
             <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-Type:application/json&quot;</span> <span class="token punctuation">\\</span>
             <span class="token parameter variable">-H</span> <span class="token string">&quot;Authorization: Bearer <span class="token variable">$TOKEN</span>&quot;</span> <span class="token punctuation">\\</span>
             <span class="token parameter variable">--data</span> <span class="token string">&#39;{&quot;type&quot;:&quot;AAAA&quot;,&quot;name&quot;:&quot;&#39;</span><span class="token variable">$DNS_RECORD</span><span class="token string">&#39;&quot;,&quot;content&quot;:&quot;&#39;</span><span class="token variable">$CURRENT_IP</span><span class="token string">&#39;&quot;,&quot;ttl&quot;:1,&quot;proxied&quot;:false}&#39;</span>
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="定时执行" tabindex="-1"><a class="header-anchor" href="#定时执行" aria-hidden="true">#</a> 定时执行</h3><h4 id="用-crontab" tabindex="-1"><a class="header-anchor" href="#用-crontab" aria-hidden="true">#</a> 用 crontab</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>crontab -e
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,8),D=e("code",null,"/path/to/script/",-1),w={href:"https://crontab.guru/",target:"_blank",rel:"noopener noreferrer"},I=t(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>* * * * * /path/to/script/setDNS.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="使用-systemd" tabindex="-1"><a class="header-anchor" href="#使用-systemd" aria-hidden="true">#</a> 使用 systemd</h4><p><strong>setDNS.service</strong></p><p>放置到 <code>/etc/systemd/system/</code> 下，注意替换 <code>/path/to/script/</code>。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[Unit]
Description=check IPv6 address and set DNS record

[Service]
ExecStart=/bin/sh /path/to/script/setDNS.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>setDNS.timer</strong></p><p>放置到 <code>/etc/systemd/system/</code> 下。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[Unit]
Description=monitor IPv6 address and set DNS record minutely

[Timer]
OnBootSec=1min
OnUnitActiveSec=1min

[Install]
WantedBy=timers.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>即时启动并添加到开机启动。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo systemctl daemon-reload
sudo systemctl start setDNS.timer
sudo systemctl enable setDNS.timer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10),y={href:"https://rongrongbq.moe/2021/08/firewall-and-DDNS-settings-for-IPv6/",target:"_blank",rel:"noopener noreferrer"},q=e("br",null,null,-1),E={href:"https://www.ipv6-cn.com/tutorials/ipv6-address-allocation-n-assignment.html",target:"_blank",rel:"noopener noreferrer"},S=e("br",null,null,-1),P={href:"https://github.com/jeessy2/ddns-go",target:"_blank",rel:"noopener noreferrer"};function U(R,C){const s=l("ExternalLinkIcon");return o(),r("div",null,[c,e("p",null,[e("a",p,[n("ubuntu20 ipv6使用eui-64地址并关闭临时地址.md"),a(s)]),u,e("a",v,[n("Linux_ipv6_无状态_设置为_eui64_有状态ipv6更改后缀 - osnosn - 博客园 (cnblogs.com)"),a(s)]),m,e("a",b,[n("networking - How to configure ipv6 with eui-64 interface id on ubuntu 18.04? - Ask Ubuntu"),a(s)]),h,e("a",f,[n("YAML configuration - Netplan documentation"),a(s)])]),g,e("ol",null,[k,_,e("li",null,[n("验证 EUI-64 地址（可选）：参见 "),e("a",x,[n("通过EUI-64自动生成IPv6地址和IPv6链路本地地址（Link-Local Address） | CCIE 工程师社区"),a(s)]),n("。")])]),N,e("p",null,[n("增加一行如下，注意替换 "),D,n("。示例为每分钟执行一次，如需修改，可参考 "),e("a",w,[n("crontab.guru"),a(s)]),n("。")]),I,e("p",null,[e("a",y,[n("正确地配置 IPv6 防火墙和 DDNS 以在公网访问设备 | 绒布地球 (rongrongbq.moe)"),a(s)]),q,e("a",E,[n("IPv6 地址规划与分配——全球可路由地址"),a(s)]),S,e("a",P,[n("jeessy2/ddns-go: Simple and easy to use DDNS"),a(s)])])])}const O=i(d,[["render",U],["__file","openwrt-ip-v6.html.vue"]]);export{O as default};
